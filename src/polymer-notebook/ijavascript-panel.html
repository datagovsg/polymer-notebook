<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">

<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">

<link rel="import" href="../../bower_components/marked-element/marked-element.html">

<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">

<dom-module id="ijavascript-panel">
  <template>
    <style>
      :host {
        display: block;
        padding: 10px;
        min-height: 350px;
        overflow-y: auto;
        @apply(--layout-vertical);
        @apply(--self-stretch);

        --paper-tabs-selection-bar-color: var(--paper-blue-500);
      }

      .layout-horizontal{
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
      }

      .fit{
        @apply(--self-stretch);
      }

      .flex{
        @apply(--layout-flex);
      }

      .md {
        padding: 10px;
        margin: 10px;
      }

      pre,
      #results{
        padding: 10px;
        min-height: 64px;
        @apply(--layout-self-stretch);
      }

      pre{
        background-color: #fafafa;
      }

      paper-icon-button{
        margin: 10px;
      }
      neon-animated-pages{
        @apply(--layout-self-stretch);
      }

    </style>

    <section on-tap="_showDetails">
      <iron-collapse opened="[[showDetails]]">
        <paper-tabs selected="{{selected}}">
          <paper-tab>Markdown</paper-tab>
          <paper-tab>Javascript</paper-tab>
          <paper-tab disabled="[[!_renderReady]]">Render</paper-tab>
        </paper-tabs>
      </iron-collapse>


      <neon-animated-pages selected="{{selected}}"
        entry-animation="slide-from-left-animation"
        exit-animation="slide-left-animation">
        <neon-animatable>
          <div class="layout-horizontal">
            <paper-icon-button icon="av:play-circle-filled" on-tap="_renderMD" alt="Render markdown"></paper-icon-button>
            <paper-textarea id="md" tabindex="1" label="Markdown" value="{{markdown}}" on-blur="_renderMD" class="flex" char-counter></paper-textarea>
          </div>
        </neon-animatable>
        <neon-animatable>
          <div class="layout-horizontal">
            <paper-icon-button icon="av:play-circle-filled" on-tap="_submitCodes" alt="Run codes"></paper-icon-button>
            <paper-textarea label="Javascript" value="{{codes}}" class="flex" char-counter></paper-textarea>
          </div>
        </neon-animatable>
        <neon-animatable>
          <div class="md" on-tap="_editMD">
            <template is="dom-if" if="[[markdown]]">
              <marked-element class="flex" markdown="[[markdown]]" >
                <div class="markdown-html"></div>
              </marked-element>
            </template>

            <pre id="codes" class="flex" ></pre>

            <pre id="results" class="flex" ></pre>
          </div>

        </neon-animatable>
      </neon-animated-pages>


    </section>



  </template>
  <script>
    (function(HiveOSS){
      HiveOSS.IJavascriptPanel = Polymer({

        is: 'ijavascript-panel',

        properties: {
          id: {
            type: Number
          },
          codes:{
            type: String,
            observer: '_renderCodes'
          },
          markdown:{
            type: String
          },
          results:{
            type: String,
            observer: '_renderResult'
          },
          edit:{
            type: Boolean,
            value: false
          },
          selected:{
            type: Number,
            value: 0
          },
          showDetails:{
            type: Boolean,
            value: false
          },
          _renderReady:{
            type: Boolean,
            value: false
          }
        },

        listeners:{
          'tap': '_showDetails'
        },

        _showDetails: function(){
          var self = this;
          this.showDetails = true;
          this.async(function(){ self.showDetails = false;},5000);
        },

        _submitCodes: function(){
          this.fire('eval',{id:this.id, code:this.codes},{bubbles:true});
          this._renderReady = true;
          this.selected = 2;
        },

        _toggleEdit: function(){
          this.edit = !this.edit;
        },

        _editMD: function(){
          var self = this;
          this.edit = true;
        },

        _renderMD: function(){
          this.edit = false;
          this.selected = 1;
        },

        _renderCodes: function(results){
          this.$.codes.innerHTML = this.fire('syntax-highlight', {code: results, lang: 'javascript'}).detail.code;
        },

        _renderResult: function(results){
          this.$.results.innerHTML = this.fire('syntax-highlight', {code: results, lang: 'javascript'}).detail.code;
        }

      });
    })(window.HiveOSS = window.HiveOSS || {});
  </script>
</dom-module>
